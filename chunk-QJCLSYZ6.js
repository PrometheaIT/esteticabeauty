import{c as h}from"./chunk-UYQORTRZ.js";import{a as l}from"./chunk-V3BUYYL4.js";import{V as o,Z as c,_ as m,f as r,m as u}from"./chunk-BIDTVNE2.js";var d=class s{constructor(t){this.router=t;let e=m(l);this.supabase=e.supabase,this.checkAuth()}supabase;_currentAdmin=new u(null);currentAdmin=this._currentAdmin.asObservable();checkAuth(){return r(this,null,function*(){try{let{data:{session:t}}=yield this.supabase.auth.getSession();if(t?.user){let{data:e}=yield this.supabase.from("admin_users").select("*").eq("id",t.user.id).single();e?this._currentAdmin.next(e):(yield this.supabase.auth.signOut(),this._currentAdmin.next(null))}else this._currentAdmin.next(null)}catch(t){console.error("Errore nel check auth:",t),this._currentAdmin.next(null)}})}login(t,e){return r(this,null,function*(){try{let{data:i,error:a}=yield this.supabase.auth.signInWithPassword({email:t,password:e});if(a)throw a;let{data:n}=yield this.supabase.from("admin_users").select("*").eq("id",i.user.id).single();return n?(this._currentAdmin.next(n),{success:!0}):(yield this.supabase.auth.signOut(),{success:!1,error:"Accesso non autorizzato"})}catch(i){return{success:!1,error:i.message}}})}logout(){return r(this,null,function*(){yield this.supabase.auth.signOut(),this._currentAdmin.next(null),this.router.navigate(["/"])})}isAuthenticated(){return this._currentAdmin.value!==null}requireAuth(){return r(this,null,function*(){return yield this.checkAuth(),this.isAuthenticated()})}static \u0275fac=function(e){return new(e||s)(c(h))};static \u0275prov=o({token:s,factory:s.\u0275fac,providedIn:"root"})};export{d as a};
