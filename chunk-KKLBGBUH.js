import{a as B}from"./chunk-3QBGKM2D.js";import{a as O}from"./chunk-V3BUYYL4.js";import{a as q,b as L,c as G,d as R,e as j,f as H,g as J,h as K,i as Q,j as U,k as X,l as Y,m as Z,n as $,o as ee}from"./chunk-SVEG3QM4.js";import{i as N,j as k,l as F,m as D}from"./chunk-MPIGBUTJ.js";import{Aa as r,Bb as M,Db as C,Eb as W,Qa as A,Va as v,_ as w,a as V,bb as c,cb as i,da as p,db as e,ea as g,f as h,hb as x,kb as S,mb as _,qb as T,rb as z,sb as I,tb as n,ub as E,vb as u,wb as b,xb as P,yb as f,zb as y}from"./chunk-BIDTVNE2.js";function ie(l,a){if(l&1&&(i(0,"option",27),n(1),e()),l&2){let t=a.$implicit;c("value",t),r(),u(" ",t==="percentage"?"Percentuale":"Importo fisso"," ")}}function ne(l,a){if(l&1&&(i(0,"option",27),n(1),e()),l&2){let t=a.$implicit;c("value",t),r(),u(" ",t==="all"?"Tutti i servizi":t==="service"?"Servizio specifico":"Prodotto"," ")}}function oe(l,a){if(l&1&&(i(0,"option",27),n(1),e()),l&2){let t=a.$implicit;c("value",t.id),r(),u(" ",t.title," ")}}function re(l,a){if(l&1){let t=x();i(0,"div",11)(1,"label",12)(2,"span",5),n(3,"spa"),e(),n(4," Servizio "),e(),i(5,"select",28),y("ngModelChange",function(d){p(t);let s=_();return f(s.currentPromotion.target_id,d)||(s.currentPromotion.target_id=d),g(d)}),i(6,"option",29),n(7,"Seleziona servizio"),e(),v(8,oe,2,2,"option",15),e()()}if(l&2){let t=_();r(5),P("ngModel",t.currentPromotion.target_id),r(3),c("ngForOf",t.services)}}function ae(l,a){if(l&1){let t=x();i(0,"button",30),S("click",function(){p(t);let d=_();return g(d.cancelEdit())}),i(1,"span",5),n(2,"cancel"),e(),n(3," Annulla "),e()}if(l&2){let t=_();c("disabled",t.loading)}}function le(l,a){if(l&1&&(i(0,"span"),n(1),e()),l&2){let t=_().$implicit,o=_(2);r(),u(" (",o.getServiceName(t.target_id),") ")}}function me(l,a){if(l&1){let t=x();i(0,"tr")(1,"td",34)(2,"div",35)(3,"strong"),n(4),e()()(),i(5,"td",36)(6,"div",35),n(7),e()(),i(8,"td",37)(9,"div",35),n(10),M(11,"date"),M(12,"date"),e()(),i(13,"td",38)(14,"div",35)(15,"span",39),n(16),v(17,le,2,1,"span",40),e()()(),i(18,"td",41)(19,"div",35)(20,"span",42),n(21),e()()(),i(22,"td",43)(23,"div",44)(24,"button",45),S("click",function(){let d=p(t).$implicit,s=_(2);return g(s.editPromotion(d))}),i(25,"span",5),n(26,"edit"),e()(),i(27,"button",46),S("click",function(){let d=p(t).$implicit,s=_(2);return g(s.togglePromotion(d))}),i(28,"span",5),n(29),e()(),i(30,"button",47),S("click",function(){let d=p(t).$implicit,s=_(2);return g(s.deletePromotion(d.id))}),i(31,"span",5),n(32,"delete"),e()()()()()}if(l&2){let t=a.$implicit;r(4),E(t.name),r(3),b(" ",t.discount_amount," ",t.discount_type==="percentage"?"%":"\u20AC"," "),r(3),b(" ",C(11,16,t.start_date,"dd/MM/yyyy")," - ",C(12,19,t.end_date,"dd/MM/yyyy")," "),r(6),u(" ",t.target_type," "),r(),c("ngIf",t.target_type==="service"&&t.target_id),r(3),z("badge-success",t.active)("badge-danger",!t.active),r(),u(" ",t.active?"Attiva":"Disattiva"," "),r(6),I(t.active?"action-btn delete":"action-btn add"),c("title",t.active?"Disattiva promozione":"Attiva promozione"),r(2),u(" ",t.active?"visibility_off":"visibility"," ")}}function de(l,a){if(l&1&&(i(0,"div",31)(1,"table",32)(2,"thead")(3,"tr")(4,"th"),n(5,"Nome"),e(),i(6,"th"),n(7,"Sconto"),e(),i(8,"th"),n(9,"Periodo"),e(),i(10,"th"),n(11,"Target"),e(),i(12,"th"),n(13,"Stato"),e(),i(14,"th"),n(15,"Azioni"),e()()(),i(16,"tbody"),v(17,me,33,22,"tr",33),e()()()),l&2){let t=_();r(17),c("ngForOf",t.promotions)}}function se(l,a){l&1&&(i(0,"div",48)(1,"span",49),n(2," hourglass_empty "),e(),i(3,"p"),n(4,"Caricamento promozioni in corso..."),e()())}var te=class l{promotionsService=w(B);supabaseService=w(O);promotions=[];services=[];editingPromotion=null;currentPromotion={name:"",discount_amount:0,discount_type:"percentage",start_date:"",end_date:"",target_type:"all",target_id:void 0,active:!0};loading=!1;discountTypes=["percentage","fixed"];targetTypes=["all","service","product"];ngOnInit(){return h(this,null,function*(){yield this.loadData()})}loadData(){return h(this,null,function*(){this.loading=!0;try{[this.promotions,this.services]=yield Promise.all([this.promotionsService.getAllPromotions(),this.supabaseService.getAllServices()])}catch(a){console.error("Errore caricamento dati:",a)}finally{this.loading=!1}})}getServiceName(a){if(!a)return"";let t=this.services.find(o=>o.id===a);return t?t.title:""}editPromotion(a){this.editingPromotion=a,this.currentPromotion=V({},a),this.currentPromotion.start_date=a.start_date.split("T")[0],this.currentPromotion.end_date=a.end_date.split("T")[0]}cancelEdit(){this.editingPromotion=null,this.resetForm()}savePromotion(){return h(this,null,function*(){this.loading=!0;try{this.editingPromotion?yield this.promotionsService.updatePromotion(this.editingPromotion.id,this.currentPromotion):yield this.promotionsService.createPromotion(this.currentPromotion),yield this.loadData(),this.resetForm()}catch(a){console.error("Errore salvataggio promozione:",a),alert("Errore nel salvataggio della promozione")}finally{this.loading=!1}})}togglePromotion(a){return h(this,null,function*(){try{yield this.promotionsService.updatePromotion(a.id,{active:!a.active}),yield this.loadData()}catch(t){console.error("Errore aggiornamento promozione:",t)}})}deletePromotion(a){return h(this,null,function*(){if(confirm("Sei sicuro di voler eliminare questa promozione?"))try{yield this.promotionsService.deletePromotion(a),yield this.loadData()}catch(t){console.error("Errore eliminazione promozione:",t),alert("Errore nell'eliminazione della promozione")}})}resetForm(){this.editingPromotion=null,this.currentPromotion={name:"",discount_amount:0,discount_type:"percentage",start_date:"",end_date:"",target_type:"all",target_id:void 0,active:!0}}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=A({type:l,selectors:[["app-admin-promotions"]],decls:76,vars:21,consts:[["loadingTemplate",""],[1,"content","full-width"],[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"sottotitolo"],[1,"form-section",3,"ngSubmit"],[1,"grid-form"],[1,"form-field"],[1,"form-label"],["type","text","name","name","placeholder","Nome della promozione","required","",3,"ngModelChange","ngModel"],["name","discount_type","required","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","number","name","discount_amount","min","0","required","",3,"ngModelChange","ngModel","placeholder","step","max"],["type","date","name","start_date","required","",3,"ngModelChange","ngModel"],["type","date","name","end_date","required","",3,"ngModelChange","ngModel"],["name","target_type","required","",3,"ngModelChange","change","ngModel"],["class","form-field",4,"ngIf"],["type","checkbox","name","active",3,"ngModelChange","ngModel"],[1,"form-actions",2,"margin-top","var(--gutter-lg)","display","flex","gap","var(--gutter-sm)","flex-wrap","wrap"],["type","submit",1,"promethea-button",3,"disabled"],["type","button","class","promethea-button ghost",3,"disabled","click",4,"ngIf"],[1,"table-section"],["class","table-container",4,"ngIf","ngIfElse"],[3,"value"],["name","target_id",3,"ngModelChange","ngModel"],["value",""],["type","button",1,"promethea-button","ghost",3,"click","disabled"],[1,"table-container"],[1,"crm-table"],[4,"ngFor","ngForOf"],["data-label","Nome"],[1,"cell-content"],["data-label","Sconto"],["data-label","Periodo"],["data-label","Target"],[1,"chip"],[4,"ngIf"],["data-label","Stato"],[1,"badge"],["data-label","Azioni"],[1,"cell-content","table-actions"],["title","Modifica promozione",1,"action-btn","edit",3,"click"],[3,"click","title"],["title","Elimina promozione",1,"action-btn","delete",3,"click"],[1,"card",2,"text-align","center","padding","var(--gutter-xl)"],[1,"material-icons",2,"font-size","3rem","margin-bottom","var(--gutter-md)"]],template:function(t,o){if(t&1){let d=x();i(0,"div",1)(1,"div",2)(2,"header",3)(3,"div",4)(4,"span",5),n(5,"local_offer"),e()(),i(6,"div",6)(7,"h1",7),n(8,"Gestione Promozioni"),e(),i(9,"p",8),n(10,"Crea e gestisci promozioni speciali"),e()()(),i(11,"form",9),S("ngSubmit",function(){return p(d),g(o.savePromotion())}),i(12,"h2",7)(13,"span",5),n(14),e(),n(15),e(),i(16,"div",10)(17,"div",11)(18,"label",12)(19,"span",5),n(20,"local_offer"),e(),n(21," Nome Promozione * "),e(),i(22,"input",13),y("ngModelChange",function(m){return p(d),f(o.currentPromotion.name,m)||(o.currentPromotion.name=m),g(m)}),e()(),i(23,"div",11)(24,"label",12)(25,"span",5),n(26,"euro"),e(),n(27," Tipo Sconto * "),e(),i(28,"select",14),y("ngModelChange",function(m){return p(d),f(o.currentPromotion.discount_type,m)||(o.currentPromotion.discount_type=m),g(m)}),v(29,ie,2,2,"option",15),e()(),i(30,"div",11)(31,"label",12)(32,"span",5),n(33,"money_off"),e(),n(34," Importo Sconto * "),e(),i(35,"input",16),y("ngModelChange",function(m){return p(d),f(o.currentPromotion.discount_amount,m)||(o.currentPromotion.discount_amount=m),g(m)}),e()(),i(36,"div",11)(37,"label",12)(38,"span",5),n(39,"date_range"),e(),n(40," Data Inizio * "),e(),i(41,"input",17),y("ngModelChange",function(m){return p(d),f(o.currentPromotion.start_date,m)||(o.currentPromotion.start_date=m),g(m)}),e()(),i(42,"div",11)(43,"label",12)(44,"span",5),n(45,"date_range"),e(),n(46," Data Fine * "),e(),i(47,"input",18),y("ngModelChange",function(m){return p(d),f(o.currentPromotion.end_date,m)||(o.currentPromotion.end_date=m),g(m)}),e()(),i(48,"div",11)(49,"label",12)(50,"span",5),n(51,"target"),e(),n(52," Target * "),e(),i(53,"select",19),y("ngModelChange",function(m){return p(d),f(o.currentPromotion.target_type,m)||(o.currentPromotion.target_type=m),g(m)}),S("change",function(){return p(d),g(o.currentPromotion.target_id=void 0)}),v(54,ne,2,2,"option",15),e()(),v(55,re,9,2,"div",20),i(56,"div",11)(57,"label",12)(58,"input",21),y("ngModelChange",function(m){return p(d),f(o.currentPromotion.active,m)||(o.currentPromotion.active=m),g(m)}),e(),i(59,"span",5),n(60,"check_circle"),e(),n(61," Promozione attiva "),e()()(),i(62,"div",22)(63,"button",23)(64,"span",5),n(65),e(),n(66),e(),v(67,ae,4,1,"button",24),e()(),i(68,"div",25)(69,"h2",7)(70,"span",5),n(71,"list"),e(),n(72," Promozioni Esistenti "),e(),v(73,de,18,1,"div",26)(74,se,5,0,"ng-template",null,0,W),e()()()}if(t&2){let d=T(75);r(14),E(o.editingPromotion?"edit":"add"),r(),u(" ",o.editingPromotion?"Modifica Promozione":"Nuova Promozione"," "),r(7),P("ngModel",o.currentPromotion.name),r(6),P("ngModel",o.currentPromotion.discount_type),r(),c("ngForOf",o.discountTypes),r(6),P("ngModel",o.currentPromotion.discount_amount),c("placeholder",o.currentPromotion.discount_type==="percentage"?"0":"0.00")("step",o.currentPromotion.discount_type==="percentage"?"1":"0.01")("max",o.currentPromotion.discount_type==="percentage"?"100":null),r(6),P("ngModel",o.currentPromotion.start_date),r(6),P("ngModel",o.currentPromotion.end_date),r(6),P("ngModel",o.currentPromotion.target_type),r(),c("ngForOf",o.targetTypes),r(),c("ngIf",o.currentPromotion.target_type==="service"),r(3),P("ngModel",o.currentPromotion.active),r(5),c("disabled",o.loading),r(2),E(o.editingPromotion?"save":"add"),r(),u(" ",o.editingPromotion?"Aggiorna":"Crea"," Promozione "),r(),c("ngIf",o.editingPromotion),r(6),c("ngIf",!o.loading)("ngIfElse",d)}},dependencies:[D,N,k,ee,J,U,X,L,K,q,Q,G,R,$,Z,Y,H,j,F],encapsulation:2})};export{te as AdminPromotions};
