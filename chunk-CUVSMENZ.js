import{c as F}from"./chunk-UYQORTRZ.js";import{a as W}from"./chunk-V3BUYYL4.js";import{b as k,c as P,f as D,h as O,i as B,j as L,k as q,m as U,n as j,o as G}from"./chunk-SVEG3QM4.js";import{i as V,j as z,m as T}from"./chunk-MPIGBUTJ.js";import{Aa as l,Qa as M,Va as w,_ as A,a as y,b,bb as m,cb as i,da as g,db as t,ea as v,eb as C,f,hb as N,kb as p,mb as s,rb as I,tb as r,ub as S,vb as h,xa as E,xb as u,yb as _,zb as x}from"./chunk-BIDTVNE2.js";function J(o,d){if(o&1&&(i(0,"option",30),r(1),t()),o&2){let e=d.$implicit;m("value",e),l(),S(e)}}function H(o,d){if(o&1&&(i(0,"div",31)(1,"p",26),r(2,"Immagine attuale:"),t(),C(3,"img",32),t()),o&2){let e=s(2);l(3),m("src",e.editingService==null?null:e.editingService.image_url,E)("alt",e.editingService==null?null:e.editingService.title)}}function K(o,d){if(o&1){let e=N();i(0,"div",9)(1,"h2",10)(2,"span",3),r(3),t(),r(4),t(),i(5,"div",11)(6,"div",12)(7,"label",13),r(8,"Titolo *"),t(),i(9,"input",14),x("ngModelChange",function(a){g(e);let n=s();return _((n.isAddingNew?n.newService:n.editingService).title,a)||((n.isAddingNew?n.newService:n.editingService).title=a),v(a)}),t()(),i(10,"div",15)(11,"label",13),r(12,"Descrizione"),t(),i(13,"textarea",16),x("ngModelChange",function(a){g(e);let n=s();return _((n.isAddingNew?n.newService:n.editingService).description,a)||((n.isAddingNew?n.newService:n.editingService).description=a),v(a)}),t()(),i(14,"div",12)(15,"label",13),r(16,"Prezzo (\u20AC) *"),t(),i(17,"input",17),x("ngModelChange",function(a){g(e);let n=s();return _((n.isAddingNew?n.newService:n.editingService).price,a)||((n.isAddingNew?n.newService:n.editingService).price=a),v(a)}),t()(),i(18,"div",12)(19,"label",13),r(20,"Durata (min) *"),t(),i(21,"input",18),x("ngModelChange",function(a){g(e);let n=s();return _((n.isAddingNew?n.newService:n.editingService).duration,a)||((n.isAddingNew?n.newService:n.editingService).duration=a),v(a)}),t()(),i(22,"div",12)(23,"label",13),r(24,"Categoria *"),t(),i(25,"select",19),x("ngModelChange",function(a){g(e);let n=s();return _((n.isAddingNew?n.newService:n.editingService).category,a)||((n.isAddingNew?n.newService:n.editingService).category=a),v(a)}),i(26,"option",20),r(27,"Seleziona categoria"),t(),w(28,J,2,2,"option",21),t()(),i(29,"div",12)(30,"label",13),r(31,"Ordine di visualizzazione"),t(),i(32,"input",22),x("ngModelChange",function(a){g(e);let n=s();return _((n.isAddingNew?n.newService:n.editingService).order,a)||((n.isAddingNew?n.newService:n.editingService).order=a),v(a)}),t()(),i(33,"div",12)(34,"label",13),r(35,"Stato"),t(),i(36,"select",23),x("ngModelChange",function(a){g(e);let n=s();return _((n.isAddingNew?n.newService:n.editingService).active,a)||((n.isAddingNew?n.newService:n.editingService).active=a),v(a)}),i(37,"option",24),r(38,"Attivo"),t(),i(39,"option",24),r(40,"Disattivo"),t()()(),i(41,"div",15)(42,"label",13),r(43,"Immagine"),t(),i(44,"input",25),p("change",function(a){g(e);let n=s();return v(n.onFileSelected(a))}),t(),i(45,"small",26),r(46,"Formati supportati: JPG, PNG, WEBP (max 5MB)"),t(),w(47,H,4,2,"div",27),t()(),i(48,"div",28)(49,"button",29),p("click",function(){g(e);let a=s();return v(a.saveService())}),i(50,"span",3),r(51),t(),r(52),t(),i(53,"button",2),p("click",function(){g(e);let a=s();return v(a.cancelEdit())}),i(54,"span",3),r(55,"cancel"),t(),r(56," Annulla "),t()()()}if(o&2){let e=s();l(3),S(e.isAddingNew?"add_circle":"edit"),l(),h(" ",e.isAddingNew?"Aggiungi":"Modifica"," Servizio "),l(5),u("ngModel",(e.isAddingNew?e.newService:e.editingService).title),l(4),u("ngModel",(e.isAddingNew?e.newService:e.editingService).description),l(4),u("ngModel",(e.isAddingNew?e.newService:e.editingService).price),l(4),u("ngModel",(e.isAddingNew?e.newService:e.editingService).duration),l(4),u("ngModel",(e.isAddingNew?e.newService:e.editingService).category),l(3),m("ngForOf",e.categories),l(4),u("ngModel",(e.isAddingNew?e.newService:e.editingService).order),l(4),u("ngModel",(e.isAddingNew?e.newService:e.editingService).active),l(),m("ngValue",!0),l(2),m("ngValue",!1),l(8),m("ngIf",e.editingService==null?null:e.editingService.image_url),l(2),m("disabled",e.uploadingImage),l(2),S(e.uploadingImage?"upload":"save"),l(),h(" ",e.uploadingImage?"Upload in corso...":"Salva"," ")}}function Q(o,d){o&1&&(i(0,"div",33)(1,"p",26),r(2,'Nessun servizio trovato. Clicca su "Nuovo Servizio" per aggiungerne uno.'),t()())}function X(o,d){if(o&1&&C(0,"img",54),o&2){let e=s().$implicit;m("src",e.image_url,E)("alt",e.title)}}function Y(o,d){o&1&&(i(0,"span",26),r(1,"Nessuna"),t())}function Z(o,d){if(o&1){let e=N();i(0,"tr")(1,"td",37)(2,"div",38),w(3,X,1,2,"img",39)(4,Y,2,0,"span",40),t()(),i(5,"td",41),r(6),t(),i(7,"td",42),r(8),t(),i(9,"td",43),r(10),t(),i(11,"td",44),r(12),t(),i(13,"td",45)(14,"span",46),r(15),t()(),i(16,"td",47),r(17),t(),i(18,"td",48)(19,"span",49),r(20),t()(),i(21,"td",50)(22,"div",51)(23,"button",52),p("click",function(){let a=g(e).$implicit,n=s(2);return v(n.startEditService(a))}),i(24,"span",3),r(25,"edit"),t()(),i(26,"button",53),p("click",function(){let a=g(e).$implicit,n=s(2);return v(n.deleteService(a))}),i(27,"span",3),r(28,"delete"),t()()()()()}if(o&2){let e=d.$implicit;l(3),m("ngIf",e.image_url),l(),m("ngIf",!e.image_url),l(2),S(e.title),l(2),S(e.description),l(2),h("",e.price," \u20AC"),l(2),h("",e.duration," min"),l(3),S(e.category),l(2),S(e.order),l(2),I("badge-success",e.active)("badge-danger",!e.active),l(),h(" ",e.active?"Attivo":"Disattivo"," ")}}function $(o,d){if(o&1&&(i(0,"div",34)(1,"table",35)(2,"thead")(3,"tr")(4,"th"),r(5,"Immagine"),t(),i(6,"th"),r(7,"Nome"),t(),i(8,"th"),r(9,"Descrizione"),t(),i(10,"th"),r(11,"Prezzo"),t(),i(12,"th"),r(13,"Durata"),t(),i(14,"th"),r(15,"Categoria"),t(),i(16,"th"),r(17,"Ordine"),t(),i(18,"th"),r(19,"Stato"),t(),i(20,"th"),r(21,"Azioni"),t()()(),i(22,"tbody"),w(23,Z,29,13,"tr",36),t()()()),o&2){let e=s();l(23),m("ngForOf",e.services)}}var R=class o{supabaseService=A(W);router=A(F);services=[];editingService=null;isAddingNew=!1;uploadingImage=!1;loading=!1;newService={title:"",description:"",price:0,duration:0,category:"Viso",image_url:"",active:!0,order:0};categories=["Viso","Corpo","Massaggi","Trattamenti","Depilazione","Manicure"];selectedFile=null;ngOnInit(){return f(this,null,function*(){yield this.loadServices()})}loadServices(){return f(this,null,function*(){this.loading=!0;try{this.services=yield this.supabaseService.getAllServices(),this.services.sort((d,e)=>(d.order||0)-(e.order||0))}catch(d){console.error("Errore nel caricamento servizi:",d),alert("Errore nel caricamento dei servizi")}finally{this.loading=!1}})}startAddService(){this.isAddingNew=!0,this.editingService=null,this.newService={title:"",description:"",price:0,duration:0,category:"Viso",image_url:"",active:!0,order:this.services.length},this.selectedFile=null}startEditService(d){this.editingService=y({},d),this.isAddingNew=!1,this.selectedFile=null}onFileSelected(d){let e=d.target.files[0];if(e){if(!e.type.startsWith("image/")){alert("Per favore seleziona solo file immagine"),d.target.value="";return}this.selectedFile=e}}saveService(){return f(this,null,function*(){if(this.isAddingNew&&!this.newService.title.trim()){alert("Il titolo \xE8 obbligatorio");return}if(this.editingService&&!this.editingService.title.trim()){alert("Il titolo \xE8 obbligatorio");return}try{let d;if(this.selectedFile){this.uploadingImage=!0;let e=`service-${Date.now()}-${this.selectedFile.name}`;d=yield this.supabaseService.uploadImage(this.selectedFile,e)}this.isAddingNew?(yield this.supabaseService.addService(b(y({},this.newService),{image_url:d||this.newService.image_url})),this.isAddingNew=!1):this.editingService&&(yield this.supabaseService.updateService(this.editingService.id,b(y({},this.editingService),{image_url:d||this.editingService.image_url})),this.editingService=null),yield this.loadServices(),this.resetForm(),alert("Servizio salvato con successo!")}catch(d){console.error("Errore nel salvataggio:",d),alert("Errore nel salvataggio del servizio")}finally{this.uploadingImage=!1}})}cancelEdit(){this.resetForm()}toggleServiceActive(d){return f(this,null,function*(){try{yield this.supabaseService.updateService(d.id,{active:!d.active}),yield this.loadServices()}catch(e){console.error("Errore nell'aggiornamento:",e),alert("Errore nell'aggiornamento del servizio")}})}deleteService(d){return f(this,null,function*(){if(confirm(`Sei sicuro di voler eliminare il servizio "${d.title}"?`))try{yield this.supabaseService.deleteService(d.id),yield this.loadServices(),alert("Servizio eliminato con successo!")}catch(e){console.error("Errore nell'eliminazione:",e),alert("Errore nell'eliminazione del servizio")}})}goBack(){this.router.navigate(["/admin"])}resetForm(){this.editingService=null,this.isAddingNew=!1,this.selectedFile=null,this.newService={title:"",description:"",price:0,duration:0,category:"Viso",image_url:"",active:!0,order:0}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=M({type:o,selectors:[["app-admin-services"]],decls:16,vars:3,consts:[[1,"page-container"],[1,"section-header"],[1,"promethea-button","ghost",3,"click"],[1,"material-icons"],[1,"promethea-button",3,"click"],["class","form-section",4,"ngIf"],[1,"table-section"],["class","no-services","style","text-align: center; padding: var(--gutter-xl);",4,"ngIf"],["class","table-container",4,"ngIf"],[1,"form-section"],[1,"section-title"],[1,"grid-form"],[1,"form-field"],[1,"form-label"],["type","text","placeholder","Nome del servizio","required","",1,"input-field",3,"ngModelChange","ngModel"],[1,"form-field","form-field-col-span"],["placeholder","Descrizione del servizio","rows","4",1,"input-field",3,"ngModelChange","ngModel"],["type","number","min","0","step","0.5","required","",1,"input-field",3,"ngModelChange","ngModel"],["type","number","min","0","required","",1,"input-field",3,"ngModelChange","ngModel"],["required","",1,"input-field",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","number","min","0",1,"input-field",3,"ngModelChange","ngModel"],[1,"input-field",3,"ngModelChange","ngModel"],[3,"ngValue"],["type","file","accept","image/*",1,"input-field",3,"change"],[1,"text-muted"],["class","current-image","style","margin-top: var(--gutter-sm);",4,"ngIf"],[1,"form-actions",2,"margin-top","var(--gutter-lg)","display","flex","gap","var(--gutter-sm)"],[1,"promethea-button",3,"click","disabled"],[3,"value"],[1,"current-image",2,"margin-top","var(--gutter-sm)"],[2,"max-width","200px","border-radius","8px","margin-top","var(--gutter-sm)",3,"src","alt"],[1,"no-services",2,"text-align","center","padding","var(--gutter-xl)"],[1,"table-container"],[1,"crm-table"],[4,"ngFor","ngForOf"],["data-label","Immagine"],[1,"cell-content"],["style","width: 50px; height: 50px; object-fit: cover; border-radius: 8px;",3,"src","alt",4,"ngIf"],["class","text-muted",4,"ngIf"],["data-label","Nome"],["data-label","Descrizione"],["data-label","Prezzo"],["data-label","Durata"],["data-label","Categoria"],[1,"chip"],["data-label","Ordine"],["data-label","Stato"],[1,"badge"],["data-label","Azioni"],[1,"table-actions",2,"display","flex","gap","var(--gutter-sm)"],["title","Modifica",1,"action-btn","edit",3,"click"],["title","Elimina",1,"action-btn","delete",3,"click"],[2,"width","50px","height","50px","object-fit","cover","border-radius","8px",3,"src","alt"]],template:function(e,c){e&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),p("click",function(){return c.goBack()}),i(3,"span",3),r(4,"arrow_back"),t(),r(5," Torna al sito "),t(),i(6,"h1"),r(7,"Gestione Servizi"),t(),i(8,"button",4),p("click",function(){return c.startAddService()}),i(9,"span",3),r(10,"add"),t(),r(11," Nuovo Servizio "),t()(),w(12,K,57,16,"div",5),i(13,"div",6),w(14,Q,3,0,"div",7)(15,$,24,1,"div",8),t()()),e&2&&(l(12),m("ngIf",c.isAddingNew||c.editingService),l(2),m("ngIf",c.services.length===0),l(),m("ngIf",c.services.length>0))},dependencies:[T,V,z,G,L,q,k,O,B,P,j,U,D],encapsulation:2})};export{R as AdminServices};
